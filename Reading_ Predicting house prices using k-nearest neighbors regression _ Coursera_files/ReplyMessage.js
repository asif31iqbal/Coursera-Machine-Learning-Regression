define("bundles/reply-message/components/ReplyMessage",["require","exports","module","react-with-addons","underscore","moment","i18n!nls/reply-message","js/lib/coursera.react-intl","bundles/phoenix/template/models/userIdentity","bundles/phoenix/components/CMLEditor","bundles/phoenix/constants/CMLEditorBlocks","bundles/teach-course/components/Checkbox","bundles/reply-message/constants/ReplyMessageConstants","bundles/reply-message/utils/ReplyMessageAPIUtils","css!./__styles__/ReplyMessage"],function(require,exports,module){"use strict";function _defaults(e,a){for(var l=Object.getOwnPropertyNames(a),t=0;t<l.length;t++){var s=l[t],n=Object.getOwnPropertyDescriptor(a,s);n&&n.configurable&&void 0===e[s]&&Object.defineProperty(e,s,n)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var m=function(){function defineProperties(n,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}return function(e,t,s){return t&&defineProperties(e.prototype,t),s&&defineProperties(e,s),e}}(),h=function get(l,i,c){var s=!0;e:for(;s;){var t=l,o=i,r=c;s=!1,null===t&&(t=Function.prototype);var e=Object.getOwnPropertyDescriptor(t,o);if(void 0===e){var n=Object.getPrototypeOf(t);if(null===n)return void 0;l=n,i=o,c=r,s=!0,e=n=void 0;continue e}if("value"in e)return e.value;var a=e.get;if(void 0===a)return void 0;return a.call(r)}},e=require("react-with-addons"),_=require("underscore"),l=require("moment"),n=require("i18n!nls/reply-message"),i=require("js/lib/coursera.react-intl"),a=i.FormattedMessage,b=i.FormattedHTMLMessage,p=require("bundles/phoenix/template/models/userIdentity"),u=require("bundles/phoenix/components/CMLEditor"),t=require("bundles/phoenix/constants/CMLEditorBlocks"),d=require("bundles/teach-course/components/Checkbox"),r=require("bundles/reply-message/constants/ReplyMessageConstants"),y=r.EntryTypes,s=r.States,c=require("bundles/reply-message/utils/ReplyMessageAPIUtils");require("css!./__styles__/ReplyMessage");var g=[t.H1,t.H2,t.H3,t.Divider,t.Bold,t.Italic,t.Underline,t.Divider,t.Link],o={definition:{dtdId:"email/1",value:"<co-content></co-content>"}},f=function(t){function ReplyMessage(){_classCallCheck(this,ReplyMessage),h(Object.getPrototypeOf(ReplyMessage.prototype),"constructor",this).apply(this,arguments),this.state={isMessageBoxOpen:!1,replyState:s.Idle,allowReply:!0,sentTime:null,message:o}}return _inherits(ReplyMessage,t),m(ReplyMessage,[{key:"handleClose",value:function handleClose(){this.setState({isMessageBoxOpen:!1})}},{key:"handleSend",value:function handleSend(){var e=this,t=this.props,n=t.entryType,a=t.entryId,l=this.state.allowReply;this.setState({replyState:s.InProgress}),c.sendMessage(n,a,!l,this.state.message).then(function(){e.setState({replyState:s.Success,message:o,sentTime:Date.now()}),e.handleClose()})}},{key:"handleButtonClick",value:function handleButtonClick(){var e=this;this.setState({isMessageBoxOpen:!0}),c.getSentMessage(this.props.entryId).then(function(t){if(!_(t.elements).isEmpty()){var n=t.elements[0].metadata;e.setState({replyState:s.Success,sentTime:n.updatedAt})}})}},{key:"handleMessageChange",value:function handleMessageChange(e){this.setState({message:e})}},{key:"handleAllowReply",value:function handleAllowReply(e){this.setState({allowReply:e})}},{key:"render",value:function render(){var r=this.props,m=r.placeholder,y=r.buttonText,t=this.state,h=t.isMessageBoxOpen,o=t.replyState,i=t.sentTime,f=t.message,c=o===s.InProgress;return e.createElement("div",{className:"rc-ReplyMessage"},h?e.createElement("div",null,o===s.Success&&e.createElement("div",{className:"sent-reply-timestamp"},e.createElement(a,{message:"Reply sent {time}",time:l(i).format("lll")})),e.createElement(u,{isFocused:!0,blocks:g,cml:f,placeholder:m,onChange:this.handleMessageChange.bind(this)}),e.createElement("footer",{className:"send-message-footer"},e.createElement("span",{className:"send-options"},e.createElement("label",null,e.createElement(d,{onChange:this.handleAllowReply.bind(this),checked:!0}),e.createElement(b,{message:n("Allow learner to reply to you at <strong>{email}</strong>"),email:p.get("email_address")}))),e.createElement("button",{className:"link-styled-button cancel-button",onClick:this.handleClose.bind(this)},n("Cancel")),e.createElement("button",{className:"teach-btn teach-btn-primary",onClick:this.handleSend.bind(this),disabled:c},n(c?"Sending...":"Send")))):e.createElement("button",{className:"link-styled-button",onClick:this.handleButtonClick.bind(this)},o===s.Success?e.createElement(a,{message:"Reply sent {time}",time:l(i).format("lll")}):y))}}],[{key:"propTypes",value:{entryId:e.PropTypes.any.isRequired,entryType:e.PropTypes.oneOf(_(y).toArray()).isRequired,placeholder:e.PropTypes.string,buttonText:e.PropTypes.string,title:e.PropTypes.string},enumerable:!0},{key:"defaultProps",value:{placeholder:n("Write a message"),buttonText:n("Reply")},enumerable:!0}]),ReplyMessage}(e.Component);module.exports=f});